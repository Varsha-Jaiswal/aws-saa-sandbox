# S3 commands:

## Create bucket:

```bash
aws s3api create-bucket --bucket s3-sandbox-vj-awscli --region eu-west-2 --create-bucket-configuration LocationConstraint=eu-west-2
```

Notes: `aws s3api create-bucket --bucket s3-sandbox-vj-awscli --region eu-west-2` -> This comman can give **IllegalLocationConstraintException** error because when we create a bucket in any region other than us-east-1, we need to specify the region in the create-bucket-configuration parameter. Hence, adding `--create-bucket-configuration LocationConstraint=eu-west-2` is required.

## List buckets:

```bash
aws s3api list-buckets
```

Notes: `aws s3api list-buckets --query "Buckets[?Name=='s3-sandbox-vj-awscli']"` -> To list the specific bucket.

## List all bucket objects:

```bash
aws s3 ls
```

Notes: `aws s3 ls s3://s3-sandbox-vj-awscli` -> To list all objects in the bucket.

## Upload file to bucket:

```bash
aws s3 cp ./file.txt s3://s3-sandbox-vj-awscli
```

Notes: If file is > 160 GB, we can upload it through CLI but not through the AWS console.
To upload a file with an expiration time: add `--expires-in 604800` to the command.

## Upload directory to bucket:

```bash
aws s3 sync ./assets s3://s3-sandbox-vj-awscli
```

Notes: Add flag `--dryrun` to check what files will be uploaded.

## Download file from bucket:

```bash
aws s3 cp s3://s3-sandbox-vj-awscli/file.txt ./downloaded_assets/file2.txt
```

Notes: You can change the file name while downloading.

## Download directory from bucket:

```bash
aws s3 sync s3://s3-sandbox-vj-awscli/assets ./downloaded_assets
```

Notes: Add flag `--dryrun` to check what files will be downloaded.

## List all the objects in the bucket:

```bash
aws s3api list-objects --bucket s3-sandbox-vj-awscli --query "Contents[]"
```

Notes: To list specific objects, use `--query "Contents[?Key=='file.txt']"`.
To list objects with a specific prefix, use `--query "Contents[?Key.startsWith('prefix/')] "`.
To just view the keys, use `--query "Contents[].Key"`.
To exclude the folder names from the result, use `--query "Contents[?Key.endsWith('/')]"`.
To exclude the files from the result, use `--query "Contents[?Key.endsWith('.txt')] "`.

## Delete specific file from bucket:

```bash
aws s3 rm s3://s3-sandbox-vj-awscli/file.txt
```

## Delete all objects from bucket:

```bash
aws s3 rm s3://s3-sandbox-vj-awscli --recursive
```

## Delete bucket:

```bash
aws s3api delete-bucket --bucket s3-sandbox-vj-awscli
```

Note: You can also use `aws s3 rb s3://s3-sandbox-vj-awscli` to delete the bucket. It may give an error **BucketNotEmpty** if the bucket is not empty.

## Get metadata of a specific object:

```bash
aws s3api head-object --bucket s3-sandbox-vj-awscli --key file.txt
```

## Enable versioning on a bucket:

```bash
aws s3api put-bucket-versioning --bucket s3-sandbox-vj-awscli --versioning-configuration Status=Enabled
```

## Disable versioning on a bucket:

```bash
aws s3api put-bucket-versioning --bucket s3-sandbox-vj-awscli --versioning-configuration Status=Disabled
```
